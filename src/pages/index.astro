---
// src/pages/index.astro
// 這是你的「首頁」

import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import { getCollection } from 'astro:content';

// 這裡就是「自動抓取」！
// Astro 會去 src/content/blog/ 抓取所有 .md 檔案
const allPosts = await getCollection('blog');

// 根據 .md 裡的 Front Matter 排序
allPosts.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());
---
<!-- 1. 套用「網站外殼」 -->
<BaseLayout>
    
    <!-- 2. 放入 kae_blog_template.html 的首頁佈局 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10 lg:gap-12">
        
        <!-- 左側：文章列表 -->
        <div class="md:col-span-2">
            
            <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">最新文章</h2>

            <!-- 3. Astro 會「循環」所有抓到的文章 -->
            {allPosts.map(post => (
                <article class="bg-[var(--bg-card)] rounded-xl shadow-lg overflow-hidden mb-8 flex transition-all duration-300 hover:shadow-xl">
                    <!-- 文字內容 -->
                    <div class="p-6 md:p-8 flex-1">
                        <div class="mb-2">
                            <!-- 從 Front Matter 讀取分類 -->
                            <span class="text-sm font-medium text-white bg-[var(--accent-color)] py-1 px-3 rounded-full">{post.data.category}</span>
                        </div>
                        <h3 class="text-2xl font-bold text-[var(--text-primary)] mb-3">
                            <!-- 從 Front Matter 讀取標題 -->
                            <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">{post.data.title}</a>
                        </h3>
                        <p class="text-[var(--text-secondary)] text-base leading-relaxed mb-4 line-clamp-2">
                            <!-- 從 Front Matter 讀取描述 -->
                            {post.data.description}
                        </p>
                        <div class="flex justify-between items-center">
                            <!-- 從 Front Matter 讀取日期 -->
                            <span class="text-sm text-gray-500">{new Date(post.data.publishDate).toLocaleDateString('zh-TW')}</span>
                            <a href={`/blog/${post.slug}`} class="text-base font-semibold text-[var(--accent-color)] hover:text-[var(--accent-hover)] transition-colors">
                                繼續閱讀 &rarr;
                            </a>
                        </div>
                    </div>
                    <!-- 1:1 圖片 (從 Front Matter 讀取預覽圖) -->
                    <div class="w-1/3 max-w-[150px] md:max-w-[180px] flex-shrink-0">
                        <img src={post.data.previewImage} alt="文章預覽圖" class="w-full h-full object-cover aspect-square">
                    </div>
                </article>
            ))}

        </div>

        <!-- 右側：側邊欄 -->
        <!-- 4. 插入「側邊欄」元件 -->
        <Sidebar />

    </div>

</BaseLayout>

---
// æª”æ¡ˆè·¯å¾‘: src/pages/archive.astro (æ‡‰ç”¨ SearchFilterBox å…ƒä»¶)
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import PostCard from '../components/PostCard.astro'; 
// ğŸ‘‡ 1. å¼•å…¥æ–°å…ƒä»¶
import SearchFilterBox from '../components/SearchFilterBox.astro'; 
import { getCollection } from 'astro:content';

const allPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort(
    (a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
  );

const allCategories = [...new Set(allPosts.flatMap(post => post.data.category))];
---
<BaseLayout pageTitle="æ‰€æœ‰æ–‡ç« " description="KAEçš„é›œè¨˜ä¸­æ‰€æœ‰çš„æ–‡ç« å½™æ•´ã€‚">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-10 lg:gap-12">
    <div class="md:col-span-2 space-y-12">
      <section>
        <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-color)]">
          æ‰€æœ‰æ–‡ç«  ({allPosts.length})
        </h2>

        <!-- 
           ğŸ‘‡ 2. æ›¿æ›èˆŠçš„æœå°‹/åˆ†é¡å€å¡Š
           å‚³å…¥ currentCategory="æ‰€æœ‰æ–‡ç« " è®“è©²æŒ‰éˆ•é«˜äº®
        -->
        <SearchFilterBox currentCategory="æ‰€æœ‰æ–‡ç« " />
        
        <div id="no-results-message" class="hidden text-center text-gray-500 py-10">
          <p>æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ–‡ç«  ğŸ˜…</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="article-list-container">
          {allPosts.map(post => (
            <div 
              class="article-card-wrapper"
              data-search-text={[
                post.data.title,
                post.data.description,
                ...post.data.category,
                ...(post.data.tags || [])
              ].join(' ').toLowerCase()}
              data-category={post.data.category.join(' ')}
            >
              <PostCard post={post} />
            </div>
          ))}
        </div>

      </section>
    </div>
    <Sidebar />
  </div>

  <!-- JavaScript è…³æœ¬å·²ç¶“è¢«ç§»åˆ° SearchFilterBox.astro è£¡é¢äº† -->

</BaseLayout>

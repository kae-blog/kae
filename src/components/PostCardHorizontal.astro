---
// src/components/PostCardHorizontal.astro
// 這是首頁「最新文章」專用的橫式卡片
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const formatDate = (date: Date) => {
  const d = new Date(date);
  return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
};
---

<article class="bg-[var(--bg-card)] rounded-xl shadow-md flex items-center p-4 hover:shadow-lg transition-all duration-300 group">
  
  <!-- 1. 左側圖片 (固定大小) -->
  <div class="w-24 h-24 flex-shrink-0 overflow-hidden border border-[var(--border-color)] mr-4 rounded-lg">
    <a href={`/blog/${post.slug}`} class="block w-full h-full">
      <img 
        src={post.data.previewImage} 
        alt={post.data.title} 
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" 
      />
    </a>
  </div>
  
  <!-- 2. 右側內容 -->
  <div class="flex-1 flex flex-col min-w-0">
    
    <!-- 分類 -->
    <div class="mb-2 flex flex-wrap gap-1 justify-end">
      {post.data.category.map(cat => (
        <a href={`/category/${cat}`} class="text-xs font-medium text-white bg-[var(--accent-color)] py-1 px-2 rounded-full hover:bg-[var(--accent-hover)] transition-colors">
          {cat}
        </a>
      ))}
    </div>

    <!-- 標題與摘要 -->
    <div class="flex-grow">
      <h3 class="text-base font-bold text-[var(--text-primary)] mb-1 line-clamp-1">
        <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">
          {post.data.title}
        </a>
      </h3>
      <p class="text-sm text-[var(--text-secondary)] line-clamp-1 mb-2">{post.data.description}</p>
    </div>

    <!-- 
       ★ 底部資訊區 (日期 + Tags + 閱讀按鈕)
    -->
    <div class="flex items-center justify-between text-xs text-gray-500 gap-3 h-6 overflow-hidden">
      
<!-- 左邊群組：日期 + Tags (強制單行截斷) -->
      <!-- 整個容器設為 flex-1 和 overflow-hidden，確保它不會佔用「閱讀更多」的空間 -->
      <div class="flex items-center gap-2 flex-1 min-w-0 overflow-hidden">
        
        <!-- 日期 (不准縮小) -->
        <span class="flex-shrink-0 whitespace-nowrap">{formatDate(post.data.publishDate)}</span>
        
        <!-- 
           ★ 關鍵修改：
           使用 flex-nowrap 確保 Tag 不會換行。
           使用 truncate class，讓 Tag 區域整體超出時，從右邊切掉。
        -->
        <div class="flex flex-nowrap gap-x-2 overflow-hidden items-center truncate">
          {post.data.tags?.map(tag => (
            <a 
              href={`/archive?q=${encodeURIComponent(tag)}`}
              class="text-xs text-gray-500 hover:text-[var(--accent-color)] hover:underline transition-colors cursor-pointer whitespace-nowrap flex-shrink-0"
            >
              #{tag}
            </a>
          ))}
        </div>
      </div>

      <!-- 右邊按鈕：閱讀更多 (靠右) -->
      <a href={`/blog/${post.slug}`} class="text-[var(--accent-color)] hover:underline ml-auto flex-shrink-0">
        閱讀 &rarr;
      </a>

    </div>
  </div>
</article>

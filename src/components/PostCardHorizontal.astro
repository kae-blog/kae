---
// src/components/PostCardHorizontal.astro (最終修正版：穩定垂直/水平佈局)
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const formatDate = (date: Date) => {
  const d = new Date(date);
  return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
};
---

<article class="bg-[var(--bg-card)] rounded-xl shadow-md flex items-center p-4 hover:shadow-lg transition-all duration-300 group">
  
  <!-- 1. 左側圖片 (固定大小) -->
  <div class="w-24 h-24 flex-shrink-0 overflow-hidden border border-[var(--border-color)] mr-4 rounded-lg">
    <a href={`/blog/${post.slug}`} class="block w-full h-full">
      <img 
        src={post.data.previewImage} 
        alt={post.data.title} 
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" 
      />
    </a>
  </div>
  
  <!-- 2. 右側內容 -->
  <div class="flex-1 flex flex-col min-w-0">
    
    <!-- 分類 (Category) -->
    <!-- 修正 3A/3B: 手機版更小，電腦版恢復 -->
    <div class="mb-2 flex flex-wrap gap-1 justify-end">
      {post.data.category.map(cat => (
        <a 
          href={`/category/${cat}`} 
          class="text-[10px] md:text-xs font-medium text-white bg-[var(--accent-color)] py-0.5 px-1.5 md:py-1 md:px-2 rounded-full hover:bg-[var(--accent-hover)] transition-colors"
        >
          {cat}
        </a>
      ))}
    </div>

    <!-- 標題與摘要 -->
    <div class="flex-grow">
      <!-- 修正 4: 手機版標題縮小 (text-sm)，電腦版保持 text-base -->
      <h3 class="text-sm md:text-base font-bold text-[var(--text-primary)] mb-1 line-clamp-1">
        <a href={`/blog/${post.slug}`} class="hover:text-[var(--accent-color)] transition-colors">
          {post.data.title}
        </a>
      </h3>
      <p class="text-sm text-[var(--text-secondary)] line-clamp-1 mb-2">{post.data.description}</p>
    </div>

    <!-- 
       ★ 底部資訊區 (複雜響應式結構)
    -->
    <div class="flex flex-col md:flex-row justify-between text-xs text-gray-500 md:gap-3">
      
      <!-- 區塊 A: 手機版日期在上/Tags在下 / 電腦版 Tags在左 -->
      <div class="flex flex-col md:flex-row md:items-center gap-1 md:gap-3 flex-1">
        
        <!-- 日期 (手機在上，電腦在左) -->
        <!-- 修正 2A/2B: 確保日期在手機上獨立佔一行 (mb-1 md:mb-0) -->
        <span class="text-xs text-gray-400 mb-1 md:mb-0 flex-shrink-0 whitespace-nowrap">
          {formatDate(post.data.publishDate)}
        </span>
        
        <!-- 
           Tags 容器 (關鍵：手機寫死 2 個，電腦自動截斷)
        -->
        <div class="flex flex-wrap gap-x-2 gap-y-1 h-5 overflow-hidden content-center">
          
          <!-- 
             Tags 邏輯：
             - 手機 (非 md) 只顯示前 2 個
             - 電腦 (md 以上) 顯示所有 Tag (由 CSS 截斷)
          -->
          {post.data.tags?.map((tag, index) => (
            <a 
              href={`/archive?q=${encodeURIComponent(tag)}`}
              class={`
                text-xs text-gray-500 hover:text-[var(--accent-color)] hover:underline transition-colors 
                whitespace-nowrap flex-shrink-0
                ${index >= 2 ? 'hidden md:inline-block' : ''} 
              `}
            >
              #{tag}
            </a>
          ))}
        </div>
      </div>

      <!-- 區塊 B: 閱讀更多 (靠右) -->
      <a href={`/blog/${post.slug}`} class="text-[var(--accent-color)] hover:underline ml-auto md:ml-0 flex-shrink-0">
        閱讀 &rarr;
      </a>

    </div>
  </div>
</article>

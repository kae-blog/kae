---
// æª”æ¡ˆè·¯å¾‘: src/components/Sidebar.astro (å·²ä¿®æ­£ï¼šå°‡æ‰€æœ‰æ–‡ç« é€£çµæå‡ç‚ºä¸»è¦æ¨™é¡Œ)
import { getCollection } from 'astro:content';
import author from '../data/author.json';
const allPosts = (await getCollection('blog')).filter(post => !post.data.draft);
const totalCount = allPosts.length;

// 1. å»ºç«‹ä¸€å€‹ Map ä¾†è¨ˆç®—æ¯å€‹åˆ†é¡žæœ‰å¹¾ç¯‡æ–‡ç« 
// (ä¾‹å¦‚: {'æ—¥æœ¬ç•™å­¸' => 1, 'ç²¾é¸æ–‡ç« ' => 1})
const categoryCounts = new Map<string, number>();
allPosts.flatMap(post => post.data.category).forEach(cat => {
  categoryCounts.set(cat, (categoryCounts.get(cat) || 0) + 1);
});
---
<aside class="md:col-span-1 space-y-8">
    
    <div class="bg-[var(--bg-card)] p-6 rounded-xl shadow-lg">
        
        <!-- 
           ðŸ‘‡ ä¿®æ­£ 1ï¼šå°‡ã€Œæ‰€æœ‰æ–‡ç« ã€é€£çµæå‡ç‚ºä¸»è¦æ¨™é¡Œ
           å®ƒä½¿ç”¨äº† H3 çš„å­—é«”å¤§å°å’Œç²—é«”ï¼Œè®“å®ƒçœ‹èµ·ä¾†æ˜¯å…¥å£ï¼ŒåŒæ™‚å…·å‚™é€£çµåŠŸèƒ½ã€‚
        -->
        <a href="/archive" class="text-xl font-bold text-[var(--text-primary)] mb-4 hover:text-[var(--accent-color)] transition-colors flex items-center justify-between">
            æ‰€æœ‰æ–‡ç«  ({totalCount}) 
            <span class="text-sm text-[var(--text-secondary)] hover:text-[var(--accent-color)]">&rarr;</span>
        </a>
        
        <!-- 
           ðŸ‘‡ ä¿®æ­£ 2ï¼šåˆ†é¡žåˆ—è¡¨ (æ¬¡ç´šé€£çµ)
           é€™è£¡åªä¿ç•™å€‹åˆ¥çš„åˆ†é¡žé …ç›®ï¼Œä¸å†é‡è¤‡é¡¯ç¤ºã€Œæ‰€æœ‰æ–‡ç« ã€é€£çµã€‚
        -->
        <ul class="space-y-2 mt-4 border-t border-[var(--border-color)] pt-4"> 
            {Array.from(categoryCounts.entries()).map(([category, count]) => (
                <li>
                    <a href={`/category/${category}`} class="block text-[var(--text-secondary)] hover:text-[var(--accent-color)] transition-colors">
                        {category} ({count})
                    </a>
                </li>
            ))}
        </ul>
        
    </div>

</aside>
